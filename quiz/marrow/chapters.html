<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marrow Chapters - NextPulse</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../../error-handler/error-handler.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <button id="backBtn" onclick="backToSubjects()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1 id="pageTitle">Marrow Chapters</h1>
            <div class="header-actions">
                <button onclick="viewBookmarkedQuestions()" class="bookmark-btn">
                    <i class="fas fa-bookmark"></i>
                    <span id="bookmarkCount">0</span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <div id="chapter-selection" class="screen">
            <div class="chapter-grid" id="chapterGrid">
                <!-- Chapters will be loaded here -->
            </div>
        </div>

        <div id="bookmarked-questions" class="screen" style="display: none;">
            <div class="bookmarked-content">
                <h2>Bookmarked Questions</h2>
                <div id="bookmarkedList">
                    <!-- Bookmarked questions will be displayed here -->
                </div>
            </div>
        </div>
    </main>

    <script src="../js/quiz-state.js"></script>
    <script src="../js/bookmark-manager.js"></script>
    <script src="../js/chapter-manager.js"></script>
    <script src="../js/navigation.js"></script>
    <script src="../js/app.js"></script>
    
    <script>
        function loadChapters() {
            const urlParams = new URLSearchParams(window.location.search);
            const subject = urlParams.get('subject');
            
            if (!subject) {
                window.safeNavigate('subjects.html');
                return;
            }
            
            document.getElementById('pageTitle').textContent = `${subject.charAt(0).toUpperCase() + subject.slice(1)} Chapters`;
            
            ChapterManager.loadChapters(subject);
        }

        function startQuiz(chapter) {
            const urlParams = new URLSearchParams(window.location.search);
            const subject = urlParams.get('subject');
            window.safeNavigate(`quiz.html?subject=${subject}&chapter=${chapter}`);
        }
        
        function backToSubjects() {
            window.safeNavigate('subjects.html');
        }
        
        function backToMainMenu() {
            window.safeNavigate('../index.html');
        }

        function viewBookmarkedQuestions() {
            BookmarkManager.viewBookmarkedQuestions();
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            QuizApp.initialize();
            loadChapters();
        });
    </script>
</body>
</html>
